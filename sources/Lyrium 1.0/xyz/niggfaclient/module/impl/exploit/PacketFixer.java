// 
// Decompiled by Procyon v0.5.36
// 

package xyz.niggfaclient.module.impl.exploit;

import java.util.Iterator;
import net.minecraft.network.Packet;
import xyz.niggfaclient.utils.network.PacketUtil;
import net.minecraft.network.play.client.C03PacketPlayer;
import xyz.niggfaclient.eventbus.annotations.EventLink;
import xyz.niggfaclient.events.impl.PacketEvent;
import xyz.niggfaclient.eventbus.Listener;
import net.minecraft.network.play.client.C08PacketPlayerBlockPlacement;
import java.util.ArrayList;
import xyz.niggfaclient.module.Category;
import xyz.niggfaclient.module.ModuleInfo;
import xyz.niggfaclient.module.Module;

@ModuleInfo(name = "PacketFixer", description = "PacketFixer", cat = Category.EXPLOIT)
public class PacketFixer extends Module
{
    private final ArrayList<C08PacketPlayerBlockPlacement> buffer;
    @EventLink
    private final Listener<PacketEvent> packetEventListener;
    static final /* synthetic */ boolean $assertionsDisabled;
    
    public PacketFixer() {
        this.buffer = new ArrayList<C08PacketPlayerBlockPlacement>();
        C08PacketPlayerBlockPlacement p;
        final Iterator<C08PacketPlayerBlockPlacement> iterator;
        C08PacketPlayerBlockPlacement p2;
        this.packetEventListener = (e -> {
            if (e.getState() == PacketEvent.State.SEND) {
                if (e.getPacket() instanceof C03PacketPlayer) {
                    if (this.buffer.size() > 1) {
                        this.buffer.removeIf(packet -> packet.getPlacedBlockDirection() != 255);
                    }
                    if (this.buffer.isEmpty()) {
                        return;
                    }
                    else {
                        p = this.buffer.get(0);
                        if (!PacketFixer.$assertionsDisabled && p == null) {
                            throw new AssertionError();
                        }
                        else {
                            if (p.getPlacedBlockDirection() != 255) {
                                if (p.facingZ >= 1.0f) {
                                    p.facingZ = 0.0f;
                                }
                                if (p.facingX >= 1.0f) {
                                    p.facingX = 0.0f;
                                }
                                if (p.facingY >= 1.0f) {
                                    p.facingY = 0.99f;
                                }
                            }
                            this.buffer.iterator();
                            while (iterator.hasNext()) {
                                p2 = iterator.next();
                                PacketUtil.sendPacketNoEvent(p2);
                            }
                            this.buffer.clear();
                        }
                    }
                }
                if (e.getPacket() instanceof C08PacketPlayerBlockPlacement) {
                    this.buffer.add((C08PacketPlayerBlockPlacement)e.getPacket());
                    e.setCancelled();
                }
            }
        });
    }
}
