package cc.slack.features.modules.impl.exploit.disablers.verus;

import cc.slack.events.impl.network.PacketEvent;
import cc.slack.events.impl.player.UpdateEvent;
import cc.slack.features.modules.impl.exploit.disablers.IDisabler;
import cc.slack.utils.client.mc;
import cc.slack.utils.network.PacketUtil;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C00PacketKeepAlive;
import net.minecraft.network.play.client.C0FPacketConfirmTransaction;
import net.minecraft.network.play.server.S37PacketStatistics;

public class VerusReachDisabler implements IDisabler {
   int transactions = 0;
   short newTransaction = 0;

   public void onEnable() {
      this.transactions = 0;
      this.newTransaction = 0;
   }

   public void onUpdate(UpdateEvent event) {
      if (mc.getPlayer().ticksExisted % 600 == 0) {
         PacketUtil.send(new C00PacketKeepAlive());
      }

   }

   public void onPacket(PacketEvent event) {
      Packet packet = event.getPacket();
      if (packet instanceof C00PacketKeepAlive) {
         event.cancel();
      }

      if (packet instanceof C0FPacketConfirmTransaction) {
         ++this.transactions;
         if (this.transactions <= 1) {
            this.newTransaction = ((C0FPacketConfirmTransaction)packet).getUid();
         }

         ((C0FPacketConfirmTransaction)packet).uid = this.newTransaction;
      }

      if (packet instanceof S37PacketStatistics) {
         this.transactions = 0;
      }

   }

   public String toString() {
      return "Verus Reach";
   }
}
