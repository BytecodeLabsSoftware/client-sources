/**
 * @project Myth
 * @author CodeMan
 * @at 20.08.22, 19:48
 */
package dev.myth.features.exploit;

import dev.codeman.eventbus.Handler;
import dev.codeman.eventbus.Listener;
import dev.myth.api.event.EventState;
import dev.myth.api.feature.Feature;
import dev.myth.events.UpdateEvent;
import dev.myth.settings.BooleanSetting;
import dev.myth.settings.NumberSetting;
import net.minecraft.network.play.client.C03PacketPlayer;

@Feature.Info(
        name = "Regen",
        description = "Allows you to regenerate health",
        category = Feature.Category.EXPLOIT
)
public class RegenFeature extends Feature {

    public final NumberSetting delay = new NumberSetting("Delay", 100, 0, 1000, 10).setSuffix("ms");
    public final NumberSetting amount = new NumberSetting("Amount", 1, 1, 10, 1);
    public final BooleanSetting onlyOnGround = new BooleanSetting("Only OnGround", true);

    private long lastTime = 0;

    @Handler
    public final Listener<UpdateEvent> updateEventListener = event -> {

        if(event.getState() != EventState.PRE) return;

        if(onlyOnGround.getValue() && !getPlayer().onGround) return;

        if(getPlayer().fallDistance > 3) return;

        if(System.currentTimeMillis() - lastTime > delay.getValue()) {

            for(int i = 0; i < amount.getValue(); i++) sendPacket(new C03PacketPlayer(getPlayer().onGround));

            lastTime = System.currentTimeMillis();
        }
    };

    @Override
    public void onEnable() {
        super.onEnable();
        lastTime = System.currentTimeMillis();
    }
}
