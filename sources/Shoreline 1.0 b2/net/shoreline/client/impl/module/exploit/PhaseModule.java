package net.shoreline.client.impl.module.exploit;

import net.shoreline.client.api.config.Config;
import net.shoreline.client.api.config.setting.BooleanConfig;
import net.shoreline.client.api.config.setting.EnumConfig;
import net.shoreline.client.api.config.setting.NumberConfig;
import net.shoreline.client.api.event.EventStage;
import net.shoreline.client.api.event.listener.EventListener;
import net.shoreline.client.api.module.ModuleCategory;
import net.shoreline.client.api.module.ToggleModule;
import net.shoreline.client.impl.event.entity.player.PlayerMoveEvent;
import net.shoreline.client.impl.event.network.PlayerUpdateEvent;
import net.shoreline.client.impl.event.network.PushOutOfBlocksEvent;
import net.shoreline.client.init.Managers;
import net.shoreline.client.util.string.EnumFormatter;
import net.minecraft.entity.vehicle.BoatEntity;
import net.shoreline.client.util.Globals;

/**
 *
 *
 * @author linus
 * @since 1.0
 */
public class PhaseModule extends ToggleModule
{
    //
    Config<Float> blocksConfig = new NumberConfig<>("Blocks", "The blocks " +
            "distance to phase clip", 0.001f, 0.003f, 10.0f);
    Config<Float> distanceConfig = new NumberConfig<>("Distance", "The " +
            "distance to phase", 0.0f, 0.2f, 10.0f);
    Config<PhaseMode> modeConfig = new EnumConfig<>("Mode", "The phase mode " +
            "for clipping into blocks", PhaseMode.BOAT, PhaseMode.values());
    Config<Boolean> autoClipConfig = new BooleanConfig("AutoClip",
            "Automatically clips into the block", true);

    /**
     *
     */
    public PhaseModule()
    {
        super("Phase", "Allows player to phase through solid blocks",
                ModuleCategory.EXPLOITS);
    }

    /**
     *
     * @return
     */
    @Override
    public String getModuleData()
    {
        return EnumFormatter.formatEnum(modeConfig.getValue());
    }

    /**
     *
     */
    @Override
    public void onEnable()
    {
        if (autoClipConfig.getValue() && mc.player != null)
        {
            double cos = Math.cos(Math.toRadians(mc.player.getYaw() + 90.0f));
            double sin = Math.sin(Math.toRadians(mc.player.getYaw() + 90.0f));
            mc.player.setPosition(mc.player.getX() + (1.0 * blocksConfig.getValue() * cos + 0.0 * blocksConfig.getValue() * sin),
                    mc.player.getY(), mc.player.getZ() + (1.0 * blocksConfig.getValue() * sin - 0.0 * blocksConfig.getValue() * cos));
        }
    }

    /**
     *
     * @param event
     */
    @EventListener
    public void onPlayerUpdate(PlayerUpdateEvent event)
    {
        if (event.getStage() != EventStage.PRE)
        {
            return;
        }
        //
        switch (modeConfig.getValue())
        {
            case BOAT ->
            {
                if (mc.player.getVehicle() instanceof BoatEntity)
                {
                    mc.player.noClip = true;
                    Managers.MOVEMENT.setMotionY(0.0);
                    mc.player.setOnGround(false);
                    mc.player.getAbilities().flying = false;
                }
            }
            case SAND ->
            {

            }
        }
    }

    /**
     *
     * @param event
     */
    @EventListener
    public void onPlayerMove(PlayerMoveEvent event)
    {
        if (mc.player.getVehicle() instanceof BoatEntity boat
                && modeConfig.getValue() == PhaseMode.BOAT)
        {
            // boat.setBoundingBox();
        }
    }

    /**
     *
     * @param event
     */
    @EventListener
    public void onPushOutOfBlocks(PushOutOfBlocksEvent event)
    {
        event.cancel();
    }

    public enum PhaseMode
    {
        BOAT,
        SAND,
        DOOR
    }
}
