package net.shoreline.client.impl.module.exploit;

import net.shoreline.client.api.config.Config;
import net.shoreline.client.api.config.setting.NumberConfig;
import net.shoreline.client.api.event.listener.EventListener;
import net.shoreline.client.api.module.ModuleCategory;
import net.shoreline.client.api.module.ToggleModule;
import net.shoreline.client.api.render.RenderManager;
import net.shoreline.client.impl.event.MouseClickEvent;
import net.shoreline.client.impl.event.render.RenderWorldEvent;
import net.shoreline.client.init.Managers;
import net.shoreline.client.init.Modules;
import net.minecraft.util.hit.BlockHitResult;
import net.minecraft.util.hit.HitResult;
import net.minecraft.util.math.BlockPos;
import org.lwjgl.glfw.GLFW;

/**
 *
 *
 * @author linus
 * @since 1.0
 */
public class ClickTPModule extends ToggleModule
{
    //
    Config<Float> rangeConfig = new NumberConfig<>("Range", "The" +
            " range for the click teleport", 1.0f, 100.0f, 200.0f);

    /**
     *
     */
    public ClickTPModule()
    {
        super("ClickTP", "Allows player to teleport to" +
                " wherever they click", ModuleCategory.EXPLOITS);
    }

    /**
     *
     * @param event
     */
    @EventListener
    public void onMouseClick(MouseClickEvent event)
    {
        if (mc.player == null || mc.world == null)
        {
            return;
        }
        if (event.getButton() == GLFW.GLFW_MOUSE_BUTTON_RIGHT
                && event.getAction() == GLFW.GLFW_PRESS && mc.currentScreen == null)
        {
            //
            HitResult result = mc.player.raycast(rangeConfig.getValue(),
                    mc.getTickDelta(), false);
            if (result != null && result.getType() == HitResult.Type.BLOCK)
            {
                BlockPos pos = ((BlockHitResult) result).getBlockPos();
                Managers.POSITION.setPosition(pos.toCenterPos().add(0.0, 0.5, 0.0));
                disable();
            }
        }
    }

    /**
     *
     * @param event
     */
    @EventListener
    public void onRenderWorld(RenderWorldEvent event)
    {
        if (mc.player == null)
        {
            return;
        }
        //
        HitResult result = mc.player.raycast(rangeConfig.getValue(),
                mc.getTickDelta(), false);
        if (result != null && result.getType() == HitResult.Type.BLOCK)
        {
            BlockPos pos = ((BlockHitResult) result).getBlockPos();
            RenderManager.renderBox(event.getMatrices(), pos,
                    Modules.COLORS.getRGB(60));
        }
    }
}
