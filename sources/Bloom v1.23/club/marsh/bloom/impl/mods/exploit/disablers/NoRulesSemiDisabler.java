package club.marsh.bloom.impl.mods.exploit.disablers;

import club.marsh.bloom.api.module.Mode;
import club.marsh.bloom.api.module.Module;
import club.marsh.bloom.impl.events.PacketEvent;
import club.marsh.bloom.api.value.Value;
import com.google.common.eventbus.Subscribe;
import net.minecraft.network.play.client.*;

public class NoRulesSemiDisabler extends Mode {


	public NoRulesSemiDisabler(Module original, String name, Value mode) {
		super(original, name, mode);
	}


	@Override
	public void onDisable() {
		if (!this.canBeUsed()) return;
	}

	@Override
	public void onEnable() {
		if (!this.canBeUsed()) return;

	}


	@Subscribe
	public void onPacket(PacketEvent e) {
		if (!this.canBeUsed()) return;
		if (e.getPacket() instanceof C0FPacketConfirmTransaction || e.getPacket() instanceof C00PacketKeepAlive) {
			e.setCancelled(true);
		} else if (e.getPacket() instanceof C0BPacketEntityAction) {
			e.setCancelled(true);
		} else if (e.getPacket() instanceof C03PacketPlayer && !(e.getPacket() instanceof C03PacketPlayer.C06PacketPlayerPosLook)) {
			C03PacketPlayer player = (C03PacketPlayer) (e.getPacket());
			mc.getNetHandler().addToSendQueueSilent(new C0CPacketInput(10,10,false,false));
			e.setPacket(new C03PacketPlayer.C06PacketPlayerPosLook(
					player.isMoving() ? player.x : mc.thePlayer.posX,
					player.isMoving() ? player.y : mc.thePlayer.posY,
					player.isMoving() ? player.z : mc.thePlayer.posZ,
					player.getYaw(),
					mc.thePlayer.ticksExisted % 10 != 0 ? player.getPitch() : 69420,
					player.isOnGround()
			));
		}

	}


}

