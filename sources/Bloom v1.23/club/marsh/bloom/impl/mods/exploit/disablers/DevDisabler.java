package club.marsh.bloom.impl.mods.exploit.disablers;

import com.google.common.eventbus.Subscribe;

import club.marsh.bloom.api.module.Mode;
import club.marsh.bloom.api.module.Module;
import club.marsh.bloom.api.value.Value;
import io.netty.buffer.Unpooled;
import net.minecraft.network.PacketBuffer;
import net.minecraft.network.play.client.*;
import club.marsh.bloom.impl.events.PacketEvent;
import club.marsh.bloom.impl.events.UpdateEvent;
import net.minecraft.network.play.server.S08PacketPlayerPosLook;

public class DevDisabler extends Mode {


	public DevDisabler(Module original, String name, Value mode) {
		super(original, name, mode);
	}


	@Override
	public void onDisable() {
		if (!this.canBeUsed()) return;
	}

	@Override
	public void onEnable() {
		if (!this.canBeUsed()) return;

	}


	@Subscribe
	public void onPacket(PacketEvent e) {
		if (!this.canBeUsed()) return;
		if (e.getPacket() instanceof C03PacketPlayer) {
			mc.thePlayer.sendPlayerAbilities();
			mc.getNetHandler().addToSendQueueSilent(new C0CPacketInput());
			mc.getNetHandler().addToSendQueueSilent(new C17PacketCustomPayload("40413eb1", new PacketBuffer(Unpooled.wrappedBuffer(new byte[]{8, 52, 48, 52, 49, 51, 101, 98, 49}))));
		} else if (e.getPacket() instanceof C0FPacketConfirmTransaction || e.getPacket() instanceof C00PacketKeepAlive) {
			e.setCancelled(true);
			//original.addMessage("DEBUG: CANCELLED " + (e.getPacket() instanceof C0FPacketConfirmTransaction ? "C0F " + ((C0FPacketConfirmTransaction) (e.getPacket())).getUid() + " TICK: " + mc.thePlayer.ticksExisted  : "C00"));
		} else if (e.getPacket() instanceof S08PacketPlayerPosLook && mc.thePlayer.ticksExisted >= 50) {
			S08PacketPlayerPosLook s08 = (S08PacketPlayerPosLook) (e.getPacket());
			if (mc.thePlayer.getDistance(s08.getX(),s08.getY(),s08.getZ()) < 10 && mc.thePlayer.getDistance(s08.getX(),s08.getY(),s08.getZ()) > 0.5) {
				mc.getNetHandler().addToSendQueueSilent(new C03PacketPlayer.C06PacketPlayerPosLook(s08.getX(),s08.getY(),s08.getZ(),s08.getYaw(),s08.getPitch(),false));
				e.setCancelled(true);
			} else if (mc.thePlayer.getDistance(s08.getX(),s08.getY(),s08.getZ()) <= 1) {
				mc.getNetHandler().addToSendQueueSilent(new C03PacketPlayer.C06PacketPlayerPosLook(mc.thePlayer.posX,mc.thePlayer.posY,mc.thePlayer.posZ,s08.getYaw(),s08.getPitch(),false));
				e.setCancelled(true);
			}
		}
	}


	@Subscribe
	public void onUpdate(UpdateEvent e) {
		if (!this.canBeUsed()) return;
	}

}
